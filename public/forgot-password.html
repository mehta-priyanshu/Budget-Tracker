<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width", initial-scale="1.0">
        <title>Reset Password</title>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <h2>Reset Your Password</h2>
        <div id="login-container">
            <div id="change-password">
            <form id="change-password-form" class="login-form"  method="post">
                <div class="container" >
                    
                    <label for="email"><b>Email</b></label>
                    <input type="email" id="email" placeholder="Enter Email" name="email" required> 
                       
                    <label for="new-password"><b>New-Password</b></label>
                    <input type="password" id="new-password" placeholder="new password" name="psw" required>
                    
                    <label for="confirm-password"><b>Confirm-Password</b></label>
                    <input type="password" id="confirm-password" placeholder="confirm password" name="psw" required>
    
                    <button type="submit">Reset</button>
                </div>
            </form>
            </div>
        </div>
        <script>
            document.getElementById('change-password-form').addEventListener('submit', async(e) =>{
                e.preventDefault();
                const email = document.getElementById('email').value;
                const newPassword = document.getElementById('new-password').value;
                const confirmPassword = document.getElementById('confirm-password').value;

                if(!email || !newPassword || !confirmPassword) {
                    alert("All fields are required");
                    return;
                }

                if(newPassword !== confirmPassword) {
                    alert("Password do not match");
                    return;
                }
                try{
                    const response = await fetch('/change-password', {
                        method: "POST",
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({email, password: newPassword}),
                    });

                    const data = await response.json();
                    alert(data.message);

                    if(response.ok){
                        window.location.href = "login.html";
                    }
                }catch(error) {
                    alert("Error changing password");
                    console.error(error);
                }
            });
        </script>
    </body>
</html>